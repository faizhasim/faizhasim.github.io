<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.143a3cb69db8d42fb79c.css">html{font-size:100}body{margin:0 0 0 calc(100vw - 100%);color:#222;line-height:1.625;font-size:1rem;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body,h1,h2,h3,h4,h5,h6{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif}h1,h2,h3,h4,h5,h6{font-weight:600}h1{font-size:2.5rem;line-height:3.25rem;margin-top:6.5rem;margin-bottom:1.625rem}h2{font-size:1.6875rem;line-height:2.4375rem}h2,h3{margin-top:3.25rem;margin-bottom:.8125rem}h3{font-size:1.375rem;line-height:1.625rem}h4{font-size:1.2rem;margin-top:2.4375rem}h4,h5{line-height:1.625rem;margin-bottom:.8125rem}h5,h6{font-size:1rem;margin-top:4.0625rem}h6{line-height:1.625rem;margin-bottom:.8125rem}img{max-width:100%;margin:inherit auto}hr,img{border:0;display:block}hr{color:#222;height:1.625rem;margin:3.25rem auto;background-size:100% 26px;background-image:linear-gradient(180deg,transparent 1px,transparent 11px,#222 0,#222 15px,transparent 0,transparent 26px);width:6.25rem}a{color:#5d93ff;text-decoration:none}a:active,a:focus,a:hover{color:#f7a046}b,strong{font-weight:600}ul{list-style:square;margin-bottom:1.625rem}ul li{padding:0 .3125rem;margin-bottom:.625rem}p{line-height:1.625rem;margin-bottom:1.625rem}blockquote{padding:0;font-style:italic;text-align:center}figure{display:block;width:100%;height:auto}figcaption{line-height:1.21875rem;margin-top:.40625rem;color:#222;font-size:.875rem;font-style:italic;margin-bottom:0;text-align:center}.anchor{margin-left:-1.875rem!important;padding-right:.875rem!important}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:19.375rem;padding:0 1.625rem}.float-right{float:right}.float-left{float:left}}code[class*=language-],pre[class*=language-]{color:#657b83;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::-moz-selection,code[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection{background:#073642}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:#073642}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background-color:#fdf6e3}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#93a1a1}.token.punctuation{color:#586e75}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#268bd2}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string,.token.url{color:#2aa198}.token.entity{color:#657b83;background:#eee8d5}.token.atrule,.token.attr-value,.token.keyword{color:#859900}.token.class-name,.token.function{color:#b58900}.token.important,.token.regex,.token.variable{color:#cb4b16}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.Author-module--author__photo--36xCH{display:inline-block;margin-bottom:0;border-radius:50%;background-clip:padding-box}.Author-module--author__title--2CaTb{font-size:1.125rem;font-weight:600;line-height:1.82813rem;margin:.8125rem 0}.Author-module--author__title-link--Yrism,.Author-module--author__title-link--Yrism:focus,.Author-module--author__title-link--Yrism:hover{color:#222}.Author-module--author__subtitle--cAaEB{color:#888;line-height:1.625rem;margin-bottom:1.625rem}.Icon-module--icon--Gpyvw{display:inline-block;width:1em;height:1em;stroke-width:0;stroke:currentColor;fill:currentColor;font-style:normal;font-weight:400;speak:none;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.Contacts-module--contacts--1rGd1{margin-bottom:1.625rem}.Contacts-module--contacts__list--3OgdW{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-flow:row wrap;-webkit-box-flex:0;flex-grow:0;flex-shrink:0;list-style:none;padding:0;margin:.625rem -.1875rem;width:8.75rem}.Contacts-module--contacts__list-item--16p9q{padding:0;margin:.25rem;display:-webkit-box;display:flex;align-content:center;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center;height:2.1875rem;width:2.1875rem;line-height:2.1875rem;border-radius:50%;text-align:center;border:1px solid #ebebeb}.Contacts-module--contacts__list-item-link--2MIDn{border:0;display:-webkit-box;display:flex;color:#222}.Contacts-module--contacts__list-item-link--2MIDn:focus,.Contacts-module--contacts__list-item-link--2MIDn:hover{color:#5d93ff}.Copyright-module--copyright--1ariN{color:#b6b6b6;font-size:.875rem}.Menu-module--menu--Efbin{margin-bottom:1.625rem}.Menu-module--menu__list--31Zeo{list-style:none;padding:0;margin:0}.Menu-module--menu__list-item--1lJ6B{padding:0;margin:.625rem 0}.Menu-module--menu__list-item-link--10Ush{font-size:1rem;color:#222;font-weight:400;border:0}.Menu-module--menu__list-item-link--10Ush:focus,.Menu-module--menu__list-item-link--10Ush:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.Menu-module--menu__list-item-link--active--2CbUO{color:#222;border-bottom:1px solid #222}.Sidebar-module--sidebar--X4z2p{width:100%}.Sidebar-module--sidebar__inner--Jdc5s{position:relative;padding:1.5625rem 1.25rem 0}@media screen and (min-width:685px){.Sidebar-module--sidebar--X4z2p{width:calc(41.625% - 1.09375rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(12n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(12n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:1.875rem 1.25rem 0}.Sidebar-module--sidebar__inner--Jdc5s:after{background:#e6e6e6;background:-webkit-gradient(linear,left top,left bottom,from(#e6e6e6),color-stop(48%,#e6e6e6),to(#fff));background:linear-gradient(180deg,#e6e6e6 0,#e6e6e6 48%,#fff);position:absolute;content:"";width:.0625rem;height:33.75rem;top:30px;right:-10px;bottom:0}}@media screen and (min-width:960px){.Sidebar-module--sidebar--X4z2p{width:calc(33.3% - 1.25rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(3n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(3n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:2.5rem}}.Layout-module--layout--3Pyz6{max-width:66.875rem;margin-left:auto;margin-right:auto}.Layout-module--layout--3Pyz6:before{content:"";display:table}.Layout-module--layout--3Pyz6:after{content:"";display:table;clear:both}.Feed-module--feed__item--2D5rE{margin-bottom:2.03125rem}.Feed-module--feed__item--2D5rE:last-child{margin-bottom:.8125rem}.Feed-module--feed__item-title--3nigr{font-size:1.6875rem;line-height:2.4375rem;margin-top:0;margin-bottom:.8125rem}.Feed-module--feed__item-title-link--iFMRs{color:#222}.Feed-module--feed__item-title-link--iFMRs:focus,.Feed-module--feed__item-title-link--iFMRs:hover{color:#222;border-bottom:1px solid #222}.Feed-module--feed__item-description--1uO8e{font-size:1rem;line-height:1.625rem;margin-bottom:1.21875rem}.Feed-module--feed__item-meta-time--3t1fg{font-size:.875rem;color:#222;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-divider--N-Q0A{margin:0 .3125rem}.Feed-module--feed__item-meta-category-link--23f8F{font-size:.875rem;color:#f7a046;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-category-link--23f8F:focus,.Feed-module--feed__item-meta-category-link--23f8F:hover{color:#5d93ff}.Feed-module--feed__item-readmore--1u6bI{font-size:1rem;color:#5d93ff}.Feed-module--feed__item-readmore--1u6bI:focus,.Feed-module--feed__item-readmore--1u6bI:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.Page-module--page--2nMky{margin-bottom:3.25rem}.Page-module--page__inner--2M_vz{padding:1.5625rem 1.25rem}.Page-module--page__title--GPD8L{font-size:2.5rem;font-weight:600;line-height:3.25rem;margin-top:0;margin-bottom:2.35625rem}.Page-module--page__body--Ic6i6{font-size:1rem;line-height:1.625rem;margin:0 0 1.625rem}@media screen and (min-width:685px){.Page-module--page--2nMky{width:calc(58.275% - .78125rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(12n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(12n+1){clear:both}.Page-module--page__inner--2M_vz{padding:1.875rem 1.25rem}}@media screen and (min-width:960px){.Page-module--page--2nMky{width:calc(66.6% - .625rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(3n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(3n+1){clear:both}.Page-module--page__inner--2M_vz{padding:2.5rem 2.1875rem}}.Pagination-module--pagination--2H3nO{margin-top:3.25rem;display:-webkit-box;display:flex}.Pagination-module--pagination__prev--bet5s{width:50%;text-align:left}.Pagination-module--pagination__prev-link--1Nzs6{color:#f7a046;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__prev-link--1Nzs6:focus,.Pagination-module--pagination__prev-link--1Nzs6:hover{color:#5d93ff}.Pagination-module--pagination__prev-link--disable--Yklx9{pointer-events:none;color:#bbb}.Pagination-module--pagination__next--3hFiN{width:50%;text-align:right}.Pagination-module--pagination__next-link--3FUtA{color:#f7a046;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__next-link--3FUtA:focus,.Pagination-module--pagination__next-link--3FUtA:hover{color:#5d93ff}.Pagination-module--pagination__next-link--disable--30UwZ{pointer-events:none;color:#bbb}.Author-module--author--2Yefr{border-top:1px solid #e6e6e6;max-width:40rem;padding-top:1.25rem;line-height:1.625rem;margin-top:1.625rem;margin-bottom:3.25rem}.Author-module--author__bio-twitter--n-O9n{display:block;text-decoration:underline}@media screen and (min-width:685px){.Author-module--author--2Yefr{margin-left:auto;margin-right:auto}}.Content-module--content--3p512{max-width:59.0625rem;padding:0 .9375rem;margin:0 auto}.Content-module--content__title--2BDW9{font-size:2rem;max-width:40rem;font-weight:600;text-align:center;line-height:2.68125rem;margin:1.625rem auto 0}.Content-module--content__body--2TrQ- figure{margin-bottom:1.625rem}.Content-module--content__body--2TrQ- figure blockquote{font-style:italic;text-align:center;margin-top:0;padding:1.625rem 0}.Content-module--content__body--2TrQ- figure blockquote p{max-width:40rem;font-size:1.6817rem;margin-top:0;margin-bottom:1.625rem;line-height:2.4375rem}.Content-module--content__body--2TrQ- a{text-decoration:underline}.Content-module--content__body--2TrQ- *{max-width:40rem;margin-left:auto;margin-right:auto}.Content-module--content__body--2TrQ- img{max-width:100%}@media screen and (min-width:960px){.Content-module--content--3p512{padding:0}.Content-module--content__title--2BDW9{font-size:3rem;line-height:3.65625rem;margin-top:3.65625rem;margin-bottom:2.4375rem}.Content-module--content__body--2TrQ-,.Content-module--content__body--2TrQ- p{font-size:1.125rem;line-height:1.82813rem;margin-bottom:1.82813rem}}.Meta-module--meta__date--29eD7{font-style:italic}.Tags-module--tags--1L_ct{margin-bottom:.8125rem}.Tags-module--tags__list--91FqN{list-style:none;margin:0 -.625rem;padding:0}.Tags-module--tags__list-item--1M30P{display:inline-block;margin:.625rem .3125rem}.Tags-module--tags__list-item-link--3SL_8{display:inline-block;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;border:1px solid #e6e6e6;text-decoration:none;border-radius:1.25rem;color:#222}.Tags-module--tags__list-item-link--3SL_8:focus,.Tags-module--tags__list-item-link--3SL_8:hover{color:#5d93ff}.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{max-width:40rem;margin:0 auto;padding:0 .9375rem}.Post-module--post__home-button--16Kl0{display:block;max-width:5.625rem;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;text-align:center;color:#222;border:1px solid #e6e6e6;border-radius:1.25rem;font-size:1rem;font-weight:400;margin-left:auto;margin-right:auto;margin-top:1.625rem}.Post-module--post__home-button--16Kl0:focus,.Post-module--post__home-button--16Kl0:hover{color:#5d93ff}@media screen and (min-width:960px){.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{padding:0}.Post-module--post__home-button--16Kl0{position:fixed;max-width:auto;margin:0;top:30px;left:30px}}</style><meta name="generator" content="Gatsby 2.20.2"/><link rel="alternate" type="application/rss+xml" title="faizhasim | Software, Programming and Thoughts" href="/rss.xml"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-33905890-2"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-33905890-2', {"send_page_view":false});
      }
      </script><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="icon" href="/icons/icon-48x48.png?v=83547e4f03fb1c0607b641bc23608c21"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#F7A046"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=83547e4f03fb1c0607b641bc23608c21"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=83547e4f03fb1c0607b641bc23608c21"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=83547e4f03fb1c0607b641bc23608c21"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=83547e4f03fb1c0607b641bc23608c21"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=83547e4f03fb1c0607b641bc23608c21"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=83547e4f03fb1c0607b641bc23608c21"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=83547e4f03fb1c0607b641bc23608c21"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=83547e4f03fb1c0607b641bc23608c21"/><title data-react-helmet="true">JavaScript DOM Testing With Mocha + Grunt + Chai jQuery - faizhasim | Software, Programming and Thoughts</title><meta data-react-helmet="true" name="description" content="I&#x27;d like to share my work on writing JavaScript DOM unit testing on a existing codebase in one of our Confluence plugins."/><meta data-react-helmet="true" property="og:site_name" content="JavaScript DOM Testing With Mocha + Grunt + Chai jQuery - faizhasim | Software, Programming and Thoughts"/><meta data-react-helmet="true" property="og:image" content="https://www.faizhasim.com/media/1500x500.jpeg"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="JavaScript DOM Testing With Mocha + Grunt + Chai jQuery - faizhasim | Software, Programming and Thoughts"/><meta data-react-helmet="true" name="twitter:description" content="I&#x27;d like to share my work on writing JavaScript DOM unit testing on a existing codebase in one of our Confluence plugins."/><meta data-react-helmet="true" name="twitter:image" content="https://www.faizhasim.com/media/1500x500.jpeg"/><link as="script" rel="preload" href="/webpack-runtime-7e419a7b4eb3fe2a7e45.js"/><link as="script" rel="preload" href="/netlify-identity-widget-171ffe191486f421f700.js"/><link as="script" rel="preload" href="/app-e363a16e0388c0b13bd6.js"/><link as="script" rel="preload" href="/styles-202e1dd43dc66df3b3e9.js"/><link as="script" rel="preload" href="/commons-e3b8a17a28463f3774c8.js"/><link as="script" rel="preload" href="/component---src-templates-post-template-js-60157e4eb8bf6120b802.js"/><link as="fetch" rel="preload" href="/page-data/posts/javascript-dom-testing-with-mocha-grunt-chai-jquery/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="Layout-module--layout--3Pyz6"><div><a class="Post-module--post__home-button--16Kl0" href="/">All Articles</a><div><div class="Content-module--content--3p512"><h1 class="Content-module--content__title--2BDW9">JavaScript DOM Testing With Mocha + Grunt + Chai jQuery</h1><div class="Content-module--content__body--2TrQ-"><p>I’d like to share my work on writing JavaScript DOM unit testing on a existing codebase in one of our Confluence plugins. </p>
<p>The goals of this unit testing are as following:</p>
<ul>
<li>Simulate JavaScript and DOM as close as possible to actual browser environment</li>
<li>Being able to easily integrate this to CI services</li>
</ul>
<h2 id="librariesframeworkstools-that-we-use" style="position:relative;"><a href="#librariesframeworkstools-that-we-use" aria-label="librariesframeworkstools that we use permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Libraries/Frameworks/Tools that We Use</h2>
<ul>
<li><a href="http://visionmedia.github.io/mocha/" target="_blank" rel="nofollow noopener noreferrer">Mocha</a> - JavaScript Test Framework</li>
<li><a href="http://sinonjs.org" target="_blank" rel="nofollow noopener noreferrer">SinonJS</a> - JavaScript Spies/Stubs/Mocks Framework</li>
<li><a href="https://npmjs.org" target="_blank" rel="nofollow noopener noreferrer">NPM</a> - Node Package Manager</li>
<li><a href="http://bower.io" target="_blank" rel="nofollow noopener noreferrer">Bower</a> - Package Manager for the Web. It doesn’t dictate you to use CommonJS module system. Just include some JS/CSS/whatever.</li>
<li><a href="http://phantomjs.org" target="_blank" rel="nofollow noopener noreferrer">PhantomJS</a> - Headless Webkit Browser</li>
<li><a href="http://gruntjs.com" target="_blank" rel="nofollow noopener noreferrer">Grunt</a> - Task-based JavaScript build tool</li>
<li><a href="http://chaijs.com" target="_blank" rel="nofollow noopener noreferrer">Chai</a> - JavaScript BDD-style assertion library</li>
<li><a href="https://github.com/chaijs/chai-jquery" target="_blank" rel="nofollow noopener noreferrer">chai-jquery</a> - Chai extension that provides a set of jQuery assertions (for DOM testing)</li>
</ul>
<h1 id="getting-things-done-from-nothing" style="position:relative;"><a href="#getting-things-done-from-nothing" aria-label="getting things done from nothing permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Getting things done from nothing…</h1>
<h2 id="environment-setup" style="position:relative;"><a href="#environment-setup" aria-label="environment setup permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Environment setup</h2>
<p>I’d like to document these steps for our own reference and install and configure <a href="https://npmjs.org" target="_blank" rel="nofollow noopener noreferrer">NPM</a> on your machine. For OSX users that use <a href="http://brew.sh" target="_blank" rel="nofollow noopener noreferrer">HomeBrew</a>, just do <code class="language-text">sudo brew install npm</code>.</p>
<p>Also, make sure to install <code class="language-text">bower</code> and <code class="language-text">grunt-cli</code> globally on your node:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">npm install -g grunt-cli bower</code></pre></div>
<h2 id="project-setup" style="position:relative;"><a href="#project-setup" aria-label="project setup permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Project Setup</h2>
<h3 id="npm-project" style="position:relative;"><a href="#npm-project" aria-label="npm project permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>NPM Project</h3>
<p>For our project, this was a “traditional” javascript codebase, probably written before things like NPM or Bower become more mainstream today. So, a new nodejs setup can be configured by calling <code class="language-text">npm init</code>, which will guide you to create <code class="language-text">package.json</code>.</p>
<p>My final <code class="language-text">package.json</code> looks something like this:</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"confluence-scaffolding"</span><span class="token punctuation">,</span>
  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"5.0.9-SNAPSHOT"</span><span class="token punctuation">,</span>
  <span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"grunt"</span><span class="token operator">:</span> <span class="token string">"~0.4.2"</span><span class="token punctuation">,</span>
    <span class="token property">"grunt-mocha"</span><span class="token operator">:</span> <span class="token string">"~0.4.7"</span><span class="token punctuation">,</span>
    <span class="token property">"grunt-jsmin-sourcemap"</span><span class="token operator">:</span> <span class="token string">"~1.10.0"</span><span class="token punctuation">,</span>
    <span class="token property">"grunt-contrib-watch"</span><span class="token operator">:</span> <span class="token string">"~0.5.3"</span><span class="token punctuation">,</span>
    <span class="token property">"grunt-contrib-handlebars"</span><span class="token operator">:</span> <span class="token string">"~0.6.0"</span><span class="token punctuation">,</span>
    <span class="token property">"grunt-contrib-clean"</span><span class="token operator">:</span> <span class="token string">"~0.5.0"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"Currently used only for BDD test using Mocha"</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"grunt test"</span><span class="token punctuation">,</span>
    <span class="token property">"install"</span><span class="token operator">:</span> <span class="token string">"bower install"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>All these <code class="language-text">grunt-**</code> dependencies are Grunt task runners. Notice the <code class="language-text">&quot;script&quot;</code> part? That means, if I type <code class="language-text">npm install</code>, it will trigger <code class="language-text">bower install</code> too. Make sure to run <code class="language-text">npm install</code> to install those dependencies locally (you might want to disable the <code class="language-text">bower install</code> part temporarily for the first time).</p>
<h3 id="bower-project" style="position:relative;"><a href="#bower-project" aria-label="bower project permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Bower Project</h3>
<p>Bower can be initiated in similar manner. Just type <code class="language-text">bower init</code> to get bower to help you to initialised <code class="language-text">bower.json</code>. See below for mine:</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"confluence-scaffolding-test"</span><span class="token punctuation">,</span>
  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"5.0.9-SNAPSHOT"</span><span class="token punctuation">,</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"jquery"</span><span class="token operator">:</span> <span class="token string">"~1.7.2"</span><span class="token punctuation">,</span>
    <span class="token property">"require-handlebars-plugin"</span><span class="token operator">:</span> <span class="token string">"~0.7.0"</span><span class="token punctuation">,</span>
    <span class="token property">"requirejs"</span><span class="token operator">:</span> <span class="token string">"~2.1.9"</span><span class="token punctuation">,</span>
    <span class="token property">"mocha"</span><span class="token operator">:</span> <span class="token string">"latest"</span><span class="token punctuation">,</span>
    <span class="token property">"chai"</span><span class="token operator">:</span> <span class="token string">"~1.8.1"</span><span class="token punctuation">,</span>
    <span class="token property">"chai-jquery"</span><span class="token operator">:</span> <span class="token string">"~1.1.2"</span><span class="token punctuation">,</span>
    <span class="token property">"aui"</span><span class="token operator">:</span> <span class="token string">"https://bitbucket.org/atlassian/aui-dist/get/master.zip"</span><span class="token punctuation">,</span>
    <span class="token property">"sinonjs"</span><span class="token operator">:</span> <span class="token string">"~1.7.3"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>I want to control where Bower install these dependencies, instead of putting them into <code class="language-text">bower_components</code> directory. So, I’ve also created <code class="language-text">.bowerrc</code> and specify the location as following:</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"directory"</span><span class="token operator">:</span> <span class="token string">"lib"</span>
<span class="token punctuation">}</span></code></pre></div>
<p>You should probably run <code class="language-text">bower install</code> after writing those. It will pull out all the assets to the corresponding directories.</p>
<h3 id="configuring-grunt" style="position:relative;"><a href="#configuring-grunt" aria-label="configuring grunt permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuring Grunt</h3>
<p>Grunt can be configured within a file called <code class="language-text">Gruntfile.js</code>. Here’s an example of mine:</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json">module.exports = function(grunt) <span class="token punctuation">{</span>
    grunt.initConfig(<span class="token punctuation">{</span>
        pkg<span class="token operator">:</span> grunt.file.readJSON('package.json')<span class="token punctuation">,</span>
        'jsmin-sourcemap'<span class="token operator">:</span> <span class="token punctuation">{</span>
            all<span class="token operator">:</span> <span class="token punctuation">{</span>
                src<span class="token operator">:</span> <span class="token punctuation">[</span>
                    'forms<span class="token comment">/**/</span>*.js'
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                dest<span class="token operator">:</span> 'tests/scaffold-combined.min.js'<span class="token punctuation">,</span>
                destMap<span class="token operator">:</span> 'tests/scaffold-combined.min.js.map'<span class="token punctuation">,</span>
                srcRoot<span class="token operator">:</span> '../'
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        mocha<span class="token operator">:</span> <span class="token punctuation">{</span>
            test<span class="token operator">:</span> <span class="token punctuation">{</span>
                src<span class="token operator">:</span> <span class="token punctuation">[</span>
                    'tests/index.html'
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                    log<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                    run<span class="token operator">:</span> <span class="token boolean">false</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        handlebars<span class="token operator">:</span> <span class="token punctuation">{</span>
            options<span class="token operator">:</span> <span class="token punctuation">{</span>
                amd<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                processName<span class="token operator">:</span> function(filePath) <span class="token punctuation">{</span>
                    return filePath.replace(/^templates\<span class="token comment">//, '').replace(/\.hbs$/, '');</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            all<span class="token operator">:</span> <span class="token punctuation">{</span>
                files<span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token property">"lib/require-handlebars-plugin/hbs/templates.js"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"tests/**/*.hbs"</span><span class="token punctuation">]</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        watch<span class="token operator">:</span> <span class="token punctuation">{</span>
            compileJs<span class="token operator">:</span> <span class="token punctuation">{</span>
                files<span class="token operator">:</span> <span class="token punctuation">[</span>'forms<span class="token comment">/**/</span>*.js'<span class="token punctuation">]</span><span class="token punctuation">,</span>
                tasks<span class="token operator">:</span> <span class="token punctuation">[</span>'jsmin-sourcemap'<span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            compileHandlebars<span class="token operator">:</span> <span class="token punctuation">{</span>
                files<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"tests/**/*.hbs"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                tasks<span class="token operator">:</span> <span class="token punctuation">[</span>'handlebars'<span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        clean<span class="token operator">:</span> <span class="token punctuation">{</span>
            test<span class="token operator">:</span> <span class="token punctuation">{</span>
                src<span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token string">"tests/repeatingComponentTest/scaffold-combined.min.js"</span><span class="token punctuation">,</span>
                    <span class="token string">"tests/repeatingComponentTest/scaffold-combined.min.js.map"</span><span class="token punctuation">,</span>
                    <span class="token string">"lib/**"</span><span class="token punctuation">,</span>
                    <span class="token string">"node_modules/**"</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>);
    grunt.loadNpmTasks('grunt-mocha');
    grunt.loadNpmTasks('grunt-jsmin-sourcemap');
    grunt.loadNpmTasks('grunt-contrib-watch');
    grunt.loadNpmTasks('grunt-contrib-handlebars');
    grunt.loadNpmTasks('grunt-contrib-clean');

    grunt.registerTask('compile'<span class="token punctuation">,</span> <span class="token punctuation">[</span>'jsmin-sourcemap'<span class="token punctuation">,</span> 'handlebars'<span class="token punctuation">]</span>);
    grunt.registerTask('default'<span class="token punctuation">,</span> <span class="token punctuation">[</span>'test'<span class="token punctuation">]</span>);
    grunt.registerTask('test'<span class="token punctuation">,</span> <span class="token punctuation">[</span>'compile'<span class="token punctuation">,</span> 'mocha'<span class="token punctuation">]</span>);
<span class="token punctuation">}</span>;</code></pre></div>
<p>On my initial version, I wrote that using <a href="http://coffeescript.org" target="_blank" rel="nofollow noopener noreferrer">Coffeescript</a>. Honestly, I like it. It was more readable, but I think it’s better to keep it as JS for now. <a href="http://gruntjs.com/getting-started" target="_blank" rel="nofollow noopener noreferrer">http://gruntjs.com/getting-started</a> has excellent documentation on how to use Grunt, I would strongly suggest for you to read that. But, I just want to highlight some of the reasons or explanations on the task configuration.</p>
<ul>
<li><code class="language-text">jsmin-sourcemap</code> – Used to compile all of existing production source code into a single JS file, to make test easier and replicate what Atlassian do with the YUI compressor. One nice thing about this task is, it produces source map! See this <a href="http://www.html5rocks.com/en/tutorials/developertools/sourcemaps/" target="_blank" rel="nofollow noopener noreferrer">blog</a> on what is source map and why it’s so damn cool.</li>
<li><code class="language-text">mocha</code> – Our mocha configuration. Note: This <code class="language-text">grunt-mocha</code> <strong>is not</strong> for running mocha on NPM environment. It basically run mocha test within PhantomJS. We purposedly set the <code class="language-text">run: false</code> due to the fact that we will trigger this on our <a href="http://requirejs.org/docs/whyamd.html" target="_blank" rel="nofollow noopener noreferrer">AMD</a> loading in the code.</li>
<li><code class="language-text">handlebars</code> – <a href="http://handlebarsjs.com" target="_blank" rel="nofollow noopener noreferrer">Handlebars</a> is a variant of MustacheJS, but with helpers and additional features. I use this to separate the mocked DOM, instead of bundling them into the JS code. I don’t want to keep pulling my hair later for unmanage codebase. Honestly, I can just interpret the mocked DOM as plaintext, but I might as well configure it as template because I thought that we might use that for future test anyway.</li>
<li><code class="language-text">watch</code> - A file watcher. It watched over on group of files. On any changes, it will trigger the selected Grunt task. I used this when writing the test. Just run <code class="language-text">grunt watch</code>.</li>
</ul>
<h1 id="writing-the-tests" style="position:relative;"><a href="#writing-the-tests" aria-label="writing the tests permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Writing the tests</h1>
<h2 id="directory-structure" style="position:relative;"><a href="#directory-structure" aria-label="directory structure permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Directory structure</h2>
<p>See the directory structure here:</p>
<ul>
<li><code class="language-text">index.html</code> - The main page entry for the Mocha test. I think I can probably make a single html entry for the test, and multiple JavaScript sources loaded via AMD to run the test. It’s more managable imo. As long as the JavaScript source does not pollute global context and override each other, it’s fine. </li>
<li><code class="language-text">index.js</code> - Main entry for <code class="language-text">requirejs</code> AMD loading. This is where I define the configuration the require js too.</li>
<li><code class="language-text">repeatingComponentTest</code> - This is an example for a test suite. I bundled all the assets (mainly Handlebar templates and Mocha test in JavaScript) within their own directory. So, if I want to test featureB in the future, I’ll just create a directory called featureB and let AMD call the test from <code class="language-text">index.js</code>.</li>
</ul>
<h2 id="configuring-amd-using-require-js" style="position:relative;"><a href="#configuring-amd-using-require-js" aria-label="configuring amd using require js permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuring AMD using require js</h2>
<h3 id="indexhtml" style="position:relative;"><a href="#indexhtml" aria-label="indexhtml permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>index.html</h3>
<p>I tried to load everything using AMD loading, but I was unable to load Atlassian’s AUI, sinonjs and mocha. While AUI and sinonjs are not written as modules, I am not exactly understand why I can’t load mocha using AMD. Some people in the community reports the same thing. So, for those libraries, I load them manually via <code class="language-text">&lt;script&gt;</code> tag within <code class="language-text">index.html</code>.</p>
<p>In the <code class="language-text">index.html</code> file, I’ve also introduced a DOM element for all my test: <code class="language-text">&lt;div id=&quot;test&quot;&gt;&lt;/div&gt;</code>.</p>
<h3 id="indexjs" style="position:relative;"><a href="#indexjs" aria-label="indexjs permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>index.js</h3>
<p>See my requireJs configuration below. I think, you probably need to refer <a href="http://requirejs.org" target="_blank" rel="nofollow noopener noreferrer">RequireJS Documentation</a> itself if you’re not familiar with AMD or RequireJS.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">require<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    paths<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">'jquery'</span>        <span class="token operator">:</span> <span class="token string">'../lib/jquery/jquery'</span><span class="token punctuation">,</span>
        <span class="token string">'underscore'</span>    <span class="token operator">:</span> <span class="token string">'../lib/underscore/underscore'</span><span class="token punctuation">,</span>
        <span class="token string">'chai'</span>          <span class="token operator">:</span> <span class="token string">'../lib/chai/chai'</span><span class="token punctuation">,</span>
        <span class="token string">'chai-jquery'</span>   <span class="token operator">:</span> <span class="token string">'../lib/chai-jquery/chai-jquery'</span><span class="token punctuation">,</span>
        <span class="token string">'handlebars'</span>    <span class="token operator">:</span> <span class="token string">'../lib/require-handlebars-plugin/hbs/handlebars'</span><span class="token punctuation">,</span>
        <span class="token string">'tpl'</span>           <span class="token operator">:</span> <span class="token string">'../lib/require-handlebars-plugin/hbs/templates'</span><span class="token punctuation">,</span>
        <span class="token string">'main-src'</span>    <span class="token operator">:</span> <span class="token string">'../'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    shim<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">'underscore'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            exports<span class="token operator">:</span> <span class="token string">'_'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">'jquery'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            exports<span class="token operator">:</span> <span class="token string">'$'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">'chai-jquery'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'jquery'</span><span class="token punctuation">,</span> <span class="token string">'chai'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'require'</span><span class="token punctuation">,</span> <span class="token string">'chai'</span><span class="token punctuation">,</span> <span class="token string">'chai-jquery'</span><span class="token punctuation">,</span> <span class="token string">'jquery'</span><span class="token punctuation">,</span> <span class="token string">'tpl'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> chai<span class="token punctuation">,</span> chaiJquery<span class="token punctuation">,</span> $<span class="token punctuation">,</span> tpl</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// Globals mocha</span>
    mocha<span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        ui<span class="token operator">:</span> <span class="token string">'bdd'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'repeatingComponentTest/list-field.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mocha<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Two interesting things I want to highlight here.</p>
<ul>
<li><code class="language-text">tpl</code> – is the template module for the Handlebars template. It is compiled by Grunt.</li>
<li><code class="language-text">require([&#39;repeatingComponentTest/list-field.js&#39;], function(require) {</code> – This block of code is where I can control on which test module I want to load for mocha test. The following <code class="language-text">mocha.run()</code> is the reason why I disabled automatic <code class="language-text">mocha.run()</code> from Grunt task.</li>
</ul>
<h3 id="sample-test" style="position:relative;"><a href="#sample-test" aria-label="sample test permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Sample Test</h3>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'require'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">require</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token string">"use strict"</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> chai <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'chai'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        chaiJquery <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'chai-jquery'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        tpl <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'tpl'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        expect <span class="token operator">=</span> chai<span class="token punctuation">.</span>expect<span class="token punctuation">;</span>

    chai<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>chaiJquery<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#test'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">after</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#test'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Checkboxes within {repeating-data}'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'With fresh Scaffolding metadata'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Should have single &lt;ul> element within the first checkbox collection'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#test'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>tpl<span class="token punctuation">[</span><span class="token string">'tests/repeatingComponentTest/checkboxesWithinRepeatingData-withoutExistingData'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">var</span> repeatingField <span class="token operator">=</span> <span class="token constant">AJS</span><span class="token punctuation">.</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.scaffold-data-add'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closest</span><span class="token punctuation">(</span><span class="token string">".scaffold-data-looping"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">scaffold</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">var</span> spyOnAddLinkClick <span class="token operator">=</span> sinon<span class="token punctuation">.</span><span class="token function">spy</span><span class="token punctuation">(</span>repeatingField<span class="token punctuation">,</span> <span class="token string">"onAddLinkClick"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">var</span> spyInitScaffoldOnElement <span class="token operator">=</span> sinon<span class="token punctuation">.</span><span class="token function">spy</span><span class="token punctuation">(</span>repeatingField<span class="token punctuation">,</span> <span class="token string">"initScaffoldOnElement"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token constant">AJS</span><span class="token punctuation">.</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.scaffold-data-add'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token function">expect</span><span class="token punctuation">(</span>spyOnAddLinkClick<span class="token punctuation">.</span>calledOnce<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token function">expect</span><span class="token punctuation">(</span>spyInitScaffoldOnElement<span class="token punctuation">.</span>calledOnce<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token function">expect</span><span class="token punctuation">(</span>
                    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.scaffold-data-content span[sd-parent="REP.0"] ul'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>You can read more on the excellent <a href="http://visionmedia.github.io/mocha/" target="_blank" rel="nofollow noopener noreferrer">Mocha Documentation</a> itself. A few things that I want to highlight from this:</p>
<ul>
<li>Always use <code class="language-text">&quot;use strict&quot;;</code> whenever possible in your JavaScript code. Enabling strict mode should be a default thing to do, unless you’re writing some hacky stuff and know what you’re doing. From my experience, global variable pollution is one of the biggest problem I had so far on maintaining legacy code. Easily avoidable with strict mode.</li>
<li>I used CommonJS style within RequireJS. For eg: <code class="language-text">var chai = require(&#39;chai&#39;)</code></li>
</ul>
<h3 id="writing-test--some-tips" style="position:relative;"><a href="#writing-test--some-tips" aria-label="writing test  some tips permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Writing Test • Some Tips</h3>
<ul>
<li>Test it on Google Chrome browser, before running <code class="language-text">grunt test</code> to test it on PhantomJS. Make debugging a hell lot easier.</li>
<li>If you’re making actual AJAX call from <code class="language-text">file:</code> location, Chrome won’t like it. Start chrome with <code class="language-text">-allow-file-access-from-files</code> parameter if you need to override that.</li>
<li>Use inline <code class="language-text">debugger</code> and <code class="language-text">console.log(...)</code> for debugging.</li>
<li>Need to make trivial changes on the JS file without keep switching application? Just write it in Google Chrome debugger itself. They have live code / html editing.</li>
</ul>
<hr>
<blockquote>
<p>ps: I’m on leave writing this blog post from my hotel. The actual code base is still on pull request for peer review. I will probably update this blog post again.</p>
</blockquote></div></div></div><div class="Post-module--post__footer--3WzWU"><div><p class="Meta-module--meta__date--29eD7">Published <!-- -->5 Jan 2014</p></div><div class="Tags-module--tags--1L_ct"><ul class="Tags-module--tags__list--91FqN"><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/functional-programming/">functional programming</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/javascript/">javascript</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/scala/">scala</a></li></ul></div><div class="Author-module--author--2Yefr"><p>Software, Programming and Thoughts.<a class="Author-module--author__bio-twitter--n-O9n" href="https://www.twitter.com/faizhasim" rel="noopener noreferrer" target="_blank"><strong>Mohd Faiz Hasim</strong> on Twitter</a></p></div></div><div class="Post-module--post__comments--25y6I"><div><div id="disqus_thread"></div></div></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/javascript-dom-testing-with-mocha-grunt-chai-jquery";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-e363a16e0388c0b13bd6.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-dc444b7ab43ef3eb1f4a.js"],"component---src-templates-not-found-template-js":["/component---src-templates-not-found-template-js-03a49449e1a83219ee25.js"],"component---src-templates-tags-list-template-js":["/component---src-templates-tags-list-template-js-baa35003cfaba412c873.js"],"component---src-templates-categories-list-template-js":["/component---src-templates-categories-list-template-js-c80da1deed6cdc790507.js"],"component---src-templates-post-template-js":["/component---src-templates-post-template-js-60157e4eb8bf6120b802.js"],"component---src-templates-page-template-js":["/component---src-templates-page-template-js-814e63885548285c5ec8.js"],"component---src-templates-tag-template-js":["/component---src-templates-tag-template-js-95137d01829fcd3f1fd6.js"],"component---src-templates-category-template-js":["/component---src-templates-category-template-js-2947248d340f0a0fbd77.js"],"component---src-templates-index-template-js":["/component---src-templates-index-template-js-81100051e6738a66737c.js"]};/*]]>*/</script><script src="/component---src-templates-post-template-js-60157e4eb8bf6120b802.js" async=""></script><script src="/commons-e3b8a17a28463f3774c8.js" async=""></script><script src="/styles-202e1dd43dc66df3b3e9.js" async=""></script><script src="/app-e363a16e0388c0b13bd6.js" async=""></script><script src="/netlify-identity-widget-171ffe191486f421f700.js" async=""></script><script src="/webpack-runtime-7e419a7b4eb3fe2a7e45.js" async=""></script></body></html>